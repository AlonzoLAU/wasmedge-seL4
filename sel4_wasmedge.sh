#!/bin/bash
# SPDX-License-Identifier: Apache-2.0
# This scripts checkout seL4 and wasmedge, and create an seL4 example app for running WebAssembly in seL4.
# If you see error like "undefined reference `__getauxval`", your aarch64-linux-gcc's version is 10 or greater.
# You can add this line to `projects/musllibc/src/misc/getauxval.c`
# ```
# weak_alias(getauxval, __getauxval);
# ```

set -xuo pipefail
# Install dependency
# See https://docs.sel4.systems/projects/buildsystem/host-dependencies.html
sudo apt install \
 cmake ccache ninja-build cmake-curses-gui \
 python3-dev python3-pip \
 libxml2-utils ncurses-dev \
 curl git doxygen device-tree-compiler \
 u-boot-tools \
 protobuf-compiler python-protobuf \
 gcc-aarch64-linux-gnu g++-aarch64-linux-gnu \
 qemu-system-aarch64 libc6-dev-arm64-cross \
 haskell-stack

pip3 install --user setuptools sel4-deps camkes-deps

# Create root directory
mkdir -pv sel4_wasmedge
cd sel4_wasmedge

# Setup project files
git clone https://gerrit.googlesource.com/git-repo .repo/repo
.repo/repo/repo init -u https://github.com/seL4/camkes-vm-examples-manifest.git

# Add external projects
mkdir -pv .repo/local_manifests/
cp ../wasmedge.xml .repo/local_manifests/wasmedge.xml

# Update and checkout files
.repo/repo/repo sync

# Apply patches

patch -p1 -d projects/camkes-tool < ../01-camkes-tool.patch

patch -p1 -d projects/llvm < ../02-llvm.patch

patch -p1 -d projects/seL4_libs < ../03-seL4_libs.patch

patch -p1 -d projects/seL4_projects_libs < ../04-seL4_projects_libs.patch

patch -p1 -d projects/vm-examples < ../05-vm-examples.patch

base64 --decode <<'EOF' | xz -cd - > projects/vm-examples/apps/Arm/wasmedge/overlay_files/nbody-c.wasm
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
H97qscRn+wIAAAAABFla
EOF

cp ~/hello.wasm projects/vm-examples/apps/Arm/wasmedge/overlay_files/hello.wasm

patch -p1 -d projects/vm-linux < ../06-vm-linux.patch

patch -p1 -d projects/wasmedge < ../07-wasmedge.patch

# Configure seL4
mkdir -p build
cd build
../init-build.sh -DCAMKES_VM_APP=wasmedge -DPLATFORM=qemu-arm-virt

# Build image
ninja
ninja
